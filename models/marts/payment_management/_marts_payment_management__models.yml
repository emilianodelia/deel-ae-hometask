version: 2

models:
  - name: fct_transactions
    description: >
      Fact model that stores globepay transactions with their corresponding 
      acceptance and chargeback status
    columns:
      - name: transaction_id
        description: "The unique primary key for each transaction. Use this to join with other payment dimension tables"
        data_tests:
          - unique:
              config:
                severity: error
          - not_null:
              config:
                severity: error
      - name: event_id
        description: "Unique event identifier associated with the recorded transaction"

      - name: processed_at
        description: "UTC timestamp of the transaction, converted from the ISO 8601 Zulu format"

      - name: status
        description: "The final outcome of the transaction"

      - name: is_cvv_provided
        description: "Boolean flag indicating if the CVV was provided by the user during checkout"

      - name: country_code
        description: "The two-character ISO country code of the card used for the transaction"

      - name: original_currency
        description: "The three-character ISO currency code used for the transaction"

      - name: usd_settled_amount
        description: "The transaction value in USD"

      - name: usd_exchange_rate
        description: "The USD exchange rate extracted from the source metadata, used to convert the local currency amount to a normalized USD value."

      - name: is_valid
        description: >
          Flags whether the transaction is valid or not based on its status. Useful for filtering out
          any records that are not relevant for critical metrics to be calculated in downstream models
      
      - name: has_chargeback
        description: >
          Boolean flag indicating if a chargeback was reported for this transaction. 
          Value TRUE indicates that the transaction was disputed by the cardholder or 
          issuing bank, resulting in a chargeback record in the source data. FALSE 
          indicates that the transaction was not disputed